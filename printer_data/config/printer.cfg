#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
### Everything below [include RatOS.cfg] will override default RatOS behavior
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### BASE SETUP
#############################################################################################################
###
[include PGe-Klipper/all_fan.cfg]
#[include PGe-Klipper/bedfans.cfg]
#[include PGe-Klipper/bedfans-dualcontrol.cfg]
#[include PGe-Klipper/brush_nozzle.cfg]
[include PGe-Klipper/Chamber_Filter.cfg]
[include PGe-Klipper/Chamber_Heater.cfg]
#[include PGe-Klipper/Chamber_Temp.cfg]
#[include PGe-Klipper/Filament_Sensor.cfg]
[include PGe-Klipper/Led_Control.cfg]
#[include PGe-Klipper/Neopixel.cfg]
#[include PGe-Klipper/Neopixel_tank.cfg]
[include PGe-Klipper/SFS_V2.cfg]
[include PGe-Klipper/Spoolman.cfg]
###
#[include RatOS/homing.cfg]
#[include RatOS/macros.cfg]
#[include RatOS/printers/v-core-3/macros.cfg]
#[include RatOS/printers/v-core-3/v-core-3.cfg]
#[include RatOS/shell-macros.cfg]
###
[include shell_command.cfg]
[include timelapse.cfg]
###
#[include PGe-Klipper/xxx.cfg]
#[include PGe-Klipper/xxx.cfg]
#[include PGe-Klipper/xxx.cfg]

#############################################################################################################
### FANS
#############################################################################################################
# # Part cooling fan
# [fan]
# # 4-pin fan connected to the controller board
# pin: PA8
# cycle_time:  0.00004

# # Hotend cooling fan
# [heater_fan toolhead_cooling_fan]
# heater: extruder
# # 2-pin fan connected to the controller board
# pin: PE5

# # Controller cooling fan
# [controller_fan controller_fan]
# # 2-pin fan connected to the controller board
# pin: PD12

# #[temperature_fan pi]
# ## Electronics fan PWM
# #pin: PD15
# #max_power: 0.60
# #control: watermark
# #max_delta: 5.0
# #sensor_type: temperature_host
# #min_temp: 10.0
# #max_temp: 80.0
# #target_temp: 50.0
# #shutdown_speed: 0.0

# [temperature_fan chamber]
# pin: PD15
# max_power: 1.0
# shutdown_speed: 0.0
# kick_start_time: 5.0
# cycle_time:0.01
# off_below:0.1
# sensor_type: Generic 3950 #NTC 100K beta 3950
# sensor_pin: PF5
# min_temp: 0
# max_temp: 75
# target_temp: 35.0
# control: watermark
# gcode_id: C

#############################################################################################################
### LED Control
#############################################################################################################
#[neopixel led_z-axis]
#pin: PE4
#chain_count: 14
#color_order: GRBW
#initial_RED: 1.0 #0.8
#initial_GREEN: 0.9765 #0.8
#initial_BLUE: 0.7294 #0.8
#initial_WHITE: 0.0 #0.8

[neopixel LEDlight]
pin: PB10                    # signal interface
chain_count: 64              # Number of lamp beads
color_order: GRBW             # colour sequence
initial_RED: 1.0             # Initial red brightness
initial_GREEN: 1.0           # Initial green brightness
initial_BLUE: 1.0            # Initial blue brightness
initial_WHITE: 1.0

#[neopixel shroud]
#pin: PA1
#chain_count: 1
#color_order: GRB

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_preheat_extruder_temp: 170
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeline" #"primeblob"
variable_nozzle_prime_start_x: "max" # min, max or number
variable_nozzle_prime_start_y: "min" # min, max or number
variable_nozzle_prime_direction: "auto" # auto, forwards, backwards
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 20
variable_skew_profile: "my_skew"
variable_end_print_park_in: "back"
variable_pause_print_park_in: "front"
variable_macro_travel_speed: 300
variable_adaptive_mesh: True

[gcode_macro _bot_data]
variable_lapse_video_size: 0
variable_lapse_filename: 'None'
variable_lapse_path: 'None'
gcode:
    M118 Setting bot lapse variables

#############################################################################################################
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin        # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 300
position_endstop: 0

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin        # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 300
position_endstop: 300

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4      # 4 for TR8*4 lead screws
homing_speed: 10
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4      # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4      # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: !e_dir_pin       # Remove ! in front of pin name to reverse the direction of extruder
rotation_distance: 5.57   # Bondtech LGX Lite default
#pressure_advance: 0.05   # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
control: pid
pid_kp: 28.413
pid_ki: 1.334
pid_kd: 151.300

#############################################################################################################
### Stepper Temp
#############################################################################################################

[temperature_sensor tmc2209_stepper_x]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor tmc2209_stepper_y]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor tmc2209_stepper_z]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor tmc2209_stepper_z1]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor tmc2209_stepper_z2]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

#############################################################################################################
#############################################################################################################

[heater_bed]
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114

# ADXL345 resonance testing configuration
#[resonance_tester]
#probe_points:
#    100,100,20 # 200mm printer
#    150,150,20 # 300mm printer
#    200,200,20 # 400mm printer
#    250,250,20 # 500mm printer

[respond]

#[skew_correction my_skew]

[exclude_object]

[auto_speed]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

# Probe configuration
[probe]
z_offset: 0.0 # Will be commented out after a successful PROBE_CALIBRATE and SAVE_CONFIG
pin: ^probe_pin# For NPN NC probes such as the Super Pinda / Vinda / SupCR / Decoprobe probes.
#pin: ^!probe_pin # NPN NO (refer to the specs of your probe)
#pin: probe_pin # PNP NO (refer to the specs of your probe)
#pin: !probe_pin # PNP NC (refer to the specs of your probe)

# REMEMBER TO TUNE SENSORLESS HOMING BEFORE ATTEMPTING TO PRINT!
# You'll find instructions in the generated sensorless-homing-*.cfg file(s),
# where you should keep your sensorless homing settings.